{% extends "base.html" %}
{% block title %}Review Application{% endblock %}
{% block content %}
<h2>Review: {{ application.scholarship.title }}</h2>

<h4>Student Details</h4>
<p>Full Name: {{ application.form_data.full_name or application.student.username }}</p>
<p>Email: {{ application.form_data.email or application.student.email }}</p>
<p>IC Number: {{ application.form_data.ic_number }}</p>
<p>DOB: {{ application.form_data.dob }}</p>
<p>Age: {{ application.form_data.age }}</p>
<p>Address: {{ application.form_data.address }}</p>
<p>Intake: {{ application.form_data.intake }}</p>
<p>Programme: {{ application.form_data.programme }}</p>
<p>Course: {{ application.form_data.course }}</p>
<p>Nationality: {{ application.form_data.nationality }}</p>
<p>Race: {{ application.form_data.race }}</p>
<p>Sex: {{ application.form_data.sex }}</p>
<p>Contact: {{ application.form_data.contact }}</p>
<p>Home Contact: {{ application.form_data.home_contact }}</p>
<p>Household Income: {{ application.form_data.household_income }}</p>

<h4>Family Details</h4>
<table class="table table-bordered">
    <tr>
        <th>Name</th>
        <th>Relationship</th>
        <th>Age</th>
        <th>Occupation</th>
        <th>Income</th>
    </tr>
    {% for i in range(application_data.family_name|length) %}
    <tr>
        <td>{{ application_data.family_name[i] }}</td>
        <td>{{ application_data.relationship[i] }}</td>
        <td>{{ application_data.family_age[i] }}</td>
        <td>{{ application_data.occupation[i] }}</td>
        <td>{{ application_data.family_income[i] }}</td>
    </tr>
    {% endfor %}
</table>

<h4>Education & Achievements</h4>
<table class="table table-bordered">
    <tr><th>School Name</th><td>{{ application_data.school_name }}</td></tr>
    <tr><th>Qualification</th><td>{{ application_data.qualification }}</td></tr>
    <tr>
        <th>Achievements</th>
        <td>
            <ul>
                {% for i in range(application_data.activity_type|length) %}
                    <li>{{ application_data.activity_type[i] }} - {{ application_data.level[i] }} - {{ application_data.year[i] }} - {{ application_data.achievement[i] }}</li>
                {% endfor %}
            </ul>
        </td>
    </tr>
</table>

<h4>Statement</h4>
<p>{{ application_data.statement }}</p>

<h4>Uploaded Documents</h4>
<ul>
    {% for doc in application.documents.split(',') %}
        <li><a href="{{ url_for('static', filename=doc.split('static/')[1]) }}" target="_blank">{{ doc.split('/')[-1] }}</a></li>
    {% endfor %}
</ul>

<h4>Review</h4>
<form method="POST">
    <div class="mb-3">
        <label class="form-label">Score (0-100)</label>
        <input type="number" name="score" class="form-control" value="{{ review.score or '' }}" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Comments</label>
        <textarea name="comment" class="form-control" rows="4" required>{{ review.comment or '' }}</textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">Application Status</label>
        <select name="status" class="form-select" required>
            {% set statuses = ['Eligible', 'Approved', 'Rejected', 'Pending'] %}
            {% for s in statuses %}
                <option value="{{ s }}" {% if application.status == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
        </select>
    </div>

    <button type="submit" class="btn btn-success">Submit Review</button>
</form>
{% endblock %}
