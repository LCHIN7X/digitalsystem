{% extends "base.html" %}
{% block title %}Review Application{% endblock %}

{% block content %}
<h2>Review: {{ application.scholarship.title }}</h2>

<h4>Student Details</h4>
<table class="table table-bordered">
    <tr>
        <th width="20%">Full Name</th>
        <td>{{ application.form_data.full_name or application.student.username }}</td>
    </tr>
    <tr>
        <th>Email</th>
        <td>{{ application.form_data.email or application.student.email }}</td>
    </tr>
    <tr>
        <th>IC Number</th>
        <td>{{ application.form_data.ic_number }}</td>
    </tr>
    <tr>
        <th>Date of Birth</th>
        <td>{{ application.form_data.dob }}</td>
    </tr>
    <tr>
        <th>Age</th>
        <td>{{ application.form_data.age }}</td>
    </tr>
    <tr>
        <th>Address</th>
        <td>{{ application.form_data.address }}</td>
    </tr>
    <tr>
        <th>Intake</th>
        <td>{{ application.form_data.intake }}</td>
    </tr>
    <tr>
        <th>Programme</th>
        <td>{{ application.form_data.programme }}</td>
    </tr>
    <tr>
        <th>Course</th>
        <td>{{ application.form_data.course }}</td>
    </tr>
    <tr>
        <th>Nationality</th>
        <td>{{ application.form_data.nationality }}</td>
    </tr>
    <tr>
        <th>Race</th>
        <td>{{ application.form_data.race }}</td>
    </tr>
    <tr>
        <th>Sex</th>
        <td>{{ application.form_data.sex }}</td>
    </tr>
    <tr>
        <th>Contact</th>
        <td>{{ application.form_data.contact }}</td>
    </tr>
    <tr>
        <th>Home Contact</th>
        <td>{{ application.form_data.home_contact }}</td>
    </tr>
    <tr>
        <th>Household Income</th>
        <td>{{ application.form_data.household_income }}</td>
    </tr>
</table>
<hr>

<h4>Family Details</h4>
<table class="table table-bordered">
    <tr>
        <th>Name</th>
        <th>Relationship</th>
        <th>Age</th>
        <th>Occupation</th>
        <th>Income</th>
    </tr>
    {% for i in range(application.form_data.family_name|length) %}
    <tr>
        <td>{{ application.form_data.family_name[i] }}</td>
        <td>{{ application.form_data.relationship[i] }}</td>
        <td>{{ application.form_data.family_age[i] }}</td>
        <td>{{ application.form_data.occupation[i] }}</td>
        <td>{{ application.form_data.family_income[i] }}</td>
    </tr>
    {% endfor %}
</table>

<hr>

<h4>Education & Achievements</h4>
<table class="table table-bordered">
    <tr>
        <th>School Name</th>
        <td>{{ application.form_data.school_name }}</td>
    </tr>
    <tr>
        <th>Qualification</th>
        <td>{{ application.form_data.qualification }}</td>
    </tr>
    <tr>
        <th>Achievements</th>
        <td>
            <ul>
                {% for i in range(application.form_data.activity_type|length) %}
                    <li>
                        {{ application.form_data.activity_type[i] }}
                        - {{ application.form_data.level[i] }}
                        - {{ application.form_data.year[i] }}
                        - {{ application.form_data.achievement[i] }}
                    </li>
                {% endfor %}
            </ul>
        </td>
    </tr>
</table>

<hr>

<h4>Personal Statement</h4>
<p>{{ application.form_data.statement }}</p>

<hr>

<h4>Uploaded Documents</h4>
<ul>
    {% for doc in application.documents.split(',') %}
        {% set d = doc.strip() %}
        {% if d %}
        <li>
            <a href="{{ url_for('static', filename=d) }}" target="_blank">
                {{ d.split('/')[-1] }}
            </a>
        </li>
        {% endif %}
    {% endfor %}
</ul>

<hr>

<h4>Review</h4>
<form method="POST">

    <div class="mb-3">
        <label class="form-label">Score (0â€“100)</label>
        <input type="number"
               name="score"
               class="form-control"
               min="0"
               max="100"
               value="{{ review.score if review else '' }}"
               required>
    </div>

    <div class="mb-3">
        <label class="form-label">Application Status</label>
        <select name="status" class="form-select" required>
            {% set statuses = ['Eligible', 'Rejected', 'Pending'] %}
            {% for s in statuses %}
                <option value="{{ s }}" {% if application.status == s %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">Comments</label>
        <textarea name="comment"
                  class="form-control"
                  rows="4"
                  required>{{ review.comment if review else '' }}</textarea>
    </div>

    <button type="submit" class="btn btn-success">
        Submit Review
    </button>
</form>

{% endblock %}

