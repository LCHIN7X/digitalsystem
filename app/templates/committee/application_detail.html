{% extends "base.html" %}
{% block title %}Application Detail{% endblock %}

{% block content %}

<div class="d-flex gap-2 mb-3">
  <a href="{{ url_for('committee.applications') }}" class="btn btn-secondary">Back to List</a>
  <a href="{{ url_for('committee.dashboard') }}" class="btn btn-outline-secondary">Dashboard</a>
</div>

<!-- ========================= -->
<!-- APPLICATION INFO -->
<!-- ========================= -->
<div class="card mb-4">
  <div class="card-body">
    <h4 class="card-title mb-3">Application Info</h4>

    <p><b>Status:</b> {{ application.status }}</p>
    <p><b>Submitted At:</b> {{ application.submitted_at }}</p>
    <p><b>Student:</b> ID {{ application.student_id }}</p>
    <p><b>Scholarship:</b> ID {{ application.scholarship_id }}</p>
  </div>
</div>

<!-- ========================= -->
<!-- DOCUMENTS -->
<!-- ========================= -->
<div class="card mb-4">
  <div class="card-body">
    <h4 class="card-title mb-3">Documents</h4>

    {% if application.documents %}
      {% set docs = application.documents.split(',') %}
      <ul class="mb-0">
        {% for doc in docs %}
          {% set d = doc.strip() %}
          {% if d %}
            <li>
              <a href="{{ url_for('static', filename=d) }}" target="_blank">
                {{ d.split('/')[-1] }}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mb-0">No uploaded documents found.</p>
    {% endif %}
  </div>
</div>

<!-- ========================= -->
<!-- REVIEWER SCORES & COMMENTS -->
<!-- ========================= -->
<div class="card mb-4">
  <div class="card-body">
    <h4 class="card-title mb-3">Reviewer Scores & Comments</h4>

    <p><b>Average Score:</b> {{ avg_score }}</p>

    {% if reviews %}
      <ul class="list-group">
        {% for r in reviews %}
          <li class="list-group-item">
            <b>Reviewer ID:</b> {{ r.reviewer_id }} <br>
            <b>Score:</b> {{ r.score }} <br>
            <b>Comment:</b>
            <div class="mt-1">{{ r.comment or "No comment" }}</div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mb-0">No reviews submitted yet.</p>
    {% endif %}
  </div>
</div>

<!-- ========================= -->
<!-- SEND DECISION (KEEP THIS) -->
<!-- ========================= -->
<div class="card mb-4">
  <div class="card-body">
    <h4 class="card-title mb-3">Send Decision</h4>

    <div class="d-flex gap-2">
      <form method="POST"
            action="{{ url_for('committee.make_decision', application_id=application.id, decision='Accepted') }}">
        <button type="submit" class="btn btn-success">Accept + Notify</button>
      </form>

      <form method="POST"
            action="{{ url_for('committee.make_decision', application_id=application.id, decision='Rejected') }}">
        <button type="submit" class="btn btn-danger">Reject + Notify</button>
      </form>
    </div>

    <p class="text-muted mt-2 mb-0">
      Notification is implemented as an in-app status update (for assignment demonstration).
    </p>
  </div>
</div>


{% endblock %}
