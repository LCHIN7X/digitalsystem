{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <h3>Application Details</h3>

  <div class="card mt-3">
    <div class="card-body">
      <p><b>Application ID:</b> {{ application.id }}</p>

      <p><b>Student ID:</b>
        {% if application.student %}
          {{ application.student.your_id or application.student.id }}
        {% else %}
          Unknown
        {% endif %}
      </p>

      <p><b>Scholarship:</b>
        {% if application.scholarship %}
          {{ application.scholarship.title }}
        {% else %}
          (Missing Scholarship)
        {% endif %}
      </p>

      <p>
        <b>Status:</b>
        <span class="badge bg-secondary">
          {{ application.status or "Pending" }}
        </span>
      </p>

      <p><b>Submitted At:</b> {{ application.submitted_at }}</p>
      <p><b>Avg Score:</b> {{ avg_score }}</p>
      <p><b>Fail Count:</b> {{ fail_count }}</p>

      <!-- ========================= -->
      <!-- ACCEPT / REJECT BUTTONS -->
      <!-- ========================= -->
      <div class="mt-3">
        {% if application.status not in ["Accepted", "Rejected"] %}
          <form method="POST"
                action="{{ url_for('committee.decide_application', application_id=application.id, decision='accept') }}"
                style="display:inline;">
            <button class="btn btn-success btn-sm">
              ‚úÖ Accept + Notify
            </button>
          </form>

          <form method="POST"
                action="{{ url_for('committee.decide_application', application_id=application.id, decision='reject') }}"
                style="display:inline;">
            <button class="btn btn-danger btn-sm">
              ‚ùå Reject + Notify
            </button>
          </form>
        {% else %}
          <p class="text-muted mt-2">
            This application has already been <b>{{ application.status }}</b>.
          </p>
        {% endif %}
      </div>

      <hr>

      <h5>Uploaded Documents</h5>
      {% if application.documents %}
        {% for doc in application.documents.split(",") %}
          <p>
            <a href="{{ url_for('static', filename=doc) }}" target="_blank">
              üìÑ {{ doc.split("/")[-1] }}
            </a>
          </p>
        {% endfor %}
      {% else %}
        <p class="text-muted">No documents uploaded.</p>
      {% endif %}

      <hr>

      <h5>Reviews</h5>
      {% if reviews %}
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Reviewer</th>
              <th>Score</th>
              <th>Decision</th>
              <th>Comment</th>
              <th>Reviewed At</th>
            </tr>
          </thead>
          <tbody>
            {% for r in reviews %}
              <tr>
                <td>{{ r.reviewer_id }}</td>
                <td>{{ r.score }}</td>
                <td>{{ r.decision or "‚Äî" }}</td>
                <td>{{ r.comment or r.comments }}</td>
                <td>{{ r.reviewed_at }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p class="text-muted">No reviews yet.</p>
      {% endif %}

      <a class="btn btn-secondary mt-3"
         href="{{ url_for('committee.applications') }}">
        ‚Üê Back
      </a>
    </div>
  </div>
</div>

{% endblock %}
