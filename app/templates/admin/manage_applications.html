{% extends "base.html" %}
{% block title %}Manage Applications{% endblock %}

{% block content %}
<h2>Manage Application Processing Stages</h2>

<div class="table-responsive">
  <table class="table table-bordered table-striped">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Student</th>
        <th>Scholarship</th>
        <th>Status</th>
        <th>Update Status</th>
        <th>Reviewers</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for a in applications %}
      <tr>
        <td>{{ a.id }}</td>
        <td>
          {{ a.student.username if a.student else a.student_id }}
        </td>
        <td>
          {{ a.scholarship.title if a.scholarship else a.scholarship_id }}
        </td>
        <td>{{ a.status }}</td>

        <td>
          <form method="POST"
                action="{{ url_for('admin.update_application_status', application_id=a.id) }}"
                class="d-flex gap-2">
            {{ forms[a.id].hidden_tag() }}
            {{ forms[a.id].status(class="form-select") }}
            <button type="submit" class="btn btn-sm btn-primary">Save</button>
          </form>
        </td>

        <td>
          <a class="btn btn-sm btn-outline-primary"
             href="{{ url_for('admin.assign_reviewers', application_id=a.id) }}">
            Assign
          </a>
        </td>

        <td>
          <a class="btn btn-sm btn-outline-dark"
             href="{{ url_for('admin.application_detail', application_id=a.id) }}">
            View
          </a>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="7" class="text-center">No applications found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
{% endblock %}
